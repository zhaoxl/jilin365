<%@title = params[:title]||"发布信息"%>

<div class="trade_info">
  <%= form_for @trade_info, url: member_trade_infos_path, html: {id: "form"} do |f|%>
  <%= hidden_field_tag :c, params[:c]%>
    <div class="form">
  		<%= render :partial => 'form', :locals => {f: f, trade_info: @trade_info, attrs: @attrs }  %>
      <div class="btn">
        <input type="submit" value="发布" />
      </div>
    </div>
  <%end%>
</div>

<%= content_for :javascript do%>
<script type="text/javascript">
var validate = {
    require: function(elem, errmsg){
        elem = $(elem);
        if(elem.val() == "")
        {
          removePrompt(errmsg);
          return false;
        }
        return true;
    },
    phone: function(elem, errmsg){
        elem = $(elem);
        var value = $.trim(elem.val());
        if(!/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|14[57]|17[0-9])[0-9]{8}$/.test(value)){
            removePrompt(errmsg);
        }
    },
    // email: function(elem, errmsg){
//         elem = $(elem);
//         var value = $.trim(elem.value);
//         if(!/^/w+((-/w+)|(/w+))*/@[A-Za-z0-9]+((/.|-)[A-Za-z0-9]+)*/.[A-Za-z0-9]+$/.test(value)){
//           removePrompt(errmsg);
//         }
//     },
    compare: function(elem1, elem2, errmsg){
        elem1 = $(elem1);
        elem2 = $(elem2);
        var tipCon = elem2.parent().find("span");
        elem2.on("change", function(){
            var value1 = $.trim(elem1[0].val());
            var value2 = $.trim(this.val());
            if(value1 !== value2){
              removePrompt(errmsg);
            }
        });
    }
};

$(function(){
  $("#form").submit(function(){
    var has_error = false;
    //验证必填字段
    $.each($(".input .require").siblings("[type=text]"), function(i, obj){
        var next = validate.require(obj, $(obj).attr("placeholder"));
        if(!next)
        {
          has_error = true;
          return false;
        }
    });
    return !has_error;
    // validate.phone("#phone", "手机号码格式不正确");
    // validate.email("#email", "电子邮箱格式不正确");
    // validate.compare("#email", "#email-c", "两次邮箱不一致");
  });

});

</script>
<%end%>